---
- environment:
    SC_HOST: "{{ sc_host }}"
    SC_USERNAME: "{{ sc_username }}"
    SC_PASSWORD: "{{ sc_password }}"

  block:
    - name: Retrieve info about the users
      scale_computing.hypercore.user_info:
      register: users
    - ansible.builtin.assert:
        that:
          - users.records != []
          - "{{ users.records[0].keys() | sort == ['fullname', 'roles', 'session_limit', 'username', 'uuid'] }}"

    - name: Retrieve info about selected user
      scale_computing.hypercore.user_info:
        username: admin
      register: user
    - ansible.builtin.assert:
        that:
          - user.records[0].username == "admin"
          - "{{ user.records[0].keys() | sort == ['fullname', 'roles', 'session_limit', 'username', 'uuid'] }}"
